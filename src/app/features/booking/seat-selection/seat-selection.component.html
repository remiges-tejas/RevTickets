@if (isLoading()) {
  <app-loader [overlay]="true" message="Loading seat layout..." />
}

@if (show()) {
  <div class="seat-selection-page">
    <!-- Show Info Header -->
    <div class="show-info">
      <div class="container">
        <div class="info-content">
          <div>
            <h1>{{ show()!.movie?.title }}</h1>
            <div class="show-meta">
              <span>{{ show()!.theater?.name }}</span>
              <span class="dot"></span>
              <span>{{ show()!.showDate | date: 'EEE, dd MMM' }}</span>
              <span class="dot"></span>
              <span>{{ show()!.showTime }}</span>
              <span class="dot"></span>
              <span class="format-badge">{{ show()!.format }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="selection-content container">
      <!-- Seat Layout -->
      <div class="seat-layout-wrapper">
        <!-- Screen -->
        <div class="screen-container">
          <div class="screen">
            <span>SCREEN</span>
          </div>
        </div>

        <!-- Seats Grid -->
        <div class="seat-grid">
          @for (rowData of seatsByRow(); track rowData[0]) {
            <div class="seat-row">
              <span class="row-label">{{ rowData[0] }}</span>
              <div class="seats">
                @for (seat of rowData[1]; track seat.id) {
                  <button
                    [class]="getSeatClass(seat)"
                    [disabled]="seat.status === 'booked'"
                    (click)="toggleSeat(seat)"
                    [title]="seat.category + ' - ₹' + seat.price"
                  >
                    {{ seat.number }}
                  </button>
                }
              </div>
              <span class="row-label">{{ rowData[0] }}</span>
            </div>
          }
        </div>

        <!-- Legend -->
        <div class="seat-legend">
          <div class="legend-item">
            <span class="seat-icon available"></span>
            <span>Available</span>
          </div>
          <div class="legend-item">
            <span class="seat-icon selected"></span>
            <span>Selected</span>
          </div>
          <div class="legend-item">
            <span class="seat-icon booked"></span>
            <span>Booked</span>
          </div>
        </div>

        <!-- Category Legend -->
        <div class="category-legend">
          @for (category of getUniqueCategories(); track category.name) {
            <div class="category-item">
              <span class="category-dot" [style.background]="category.color"></span>
              <span>{{ category.name }} - ₹{{ category.price }}</span>
            </div>
          }
        </div>
      </div>

      <!-- Selection Summary -->
      <div class="selection-summary">
        <div class="summary-card">
          <h3>Booking Summary</h3>

          @if (selectedSeats().length > 0) {
            <div class="selected-seats">
              <label>Selected Seats</label>
              <div class="seats-list">
                @for (seat of selectedSeats(); track seat.id) {
                  <span class="seat-chip">
                    {{ seat.row }}{{ seat.number }}
                    <span class="seat-price">₹{{ seat.price }}</span>
                  </span>
                }
              </div>
            </div>

            <div class="summary-breakdown">
              <div class="summary-row">
                <span>Tickets ({{ selectedSeats().length }})</span>
                <span>₹{{ totalAmount() }}</span>
              </div>
            </div>

            <div class="summary-total">
              <span>Total</span>
              <span>₹{{ totalAmount() }}</span>
            </div>

            <button
              class="btn-proceed"
              (click)="proceedToCheckout()"
              [disabled]="isProcessing()"
            >
              @if (isProcessing()) {
                <span class="spinner"></span>
                Processing...
              } @else {
                Proceed to Pay ₹{{ totalAmount() }}
              }
            </button>
          } @else {
            <div class="no-selection">
              <span class="material-icons">event_seat</span>
              <p>Select your seats</p>
              <span class="hint">Click on available seats to select</span>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
}
