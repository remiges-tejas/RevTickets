<div class="profile-page">
  <div class="container">
    <h1>My Account</h1>

    <!-- Tabs -->
    <div class="tabs">
      <button
        [class.active]="activeTab() === 'profile'"
        (click)="setTab('profile')"
      >
        <span class="material-icons">person</span>
        Profile
      </button>
      <button
        [class.active]="activeTab() === 'bookings'"
        (click)="setTab('bookings')"
      >
        <span class="material-icons">confirmation_number</span>
        Bookings
      </button>
      <button
        [class.active]="activeTab() === 'payments'"
        (click)="setTab('payments')"
      >
        <span class="material-icons">payment</span>
        Payments
      </button>
    </div>

    <!-- Profile Tab -->
    @if (activeTab() === 'profile') {
      <div class="tab-content">
        <div class="profile-card">
          <div class="card-header">
            <h2>Personal Information</h2>
            @if (!isEditing()) {
              <button class="btn-edit" (click)="toggleEdit()">
                <span class="material-icons">edit</span>
                Edit
              </button>
            }
          </div>

          <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
            <div class="form-grid">
              <div class="form-group">
                <label>Full Name</label>
                @if (isEditing()) {
                  <input type="text" formControlName="name" />
                } @else {
                  <p>{{ user()?.fullName }}</p>
                }
              </div>

              <div class="form-group">
                <label>Email Address</label>
                @if (isEditing()) {
                  <input type="email" formControlName="email" />
                } @else {
                  <p>{{ user()?.email }}</p>
                }
              </div>

              <div class="form-group">
                <label>Phone Number</label>
                @if (isEditing()) {
                  <input type="tel" formControlName="phone" placeholder="Enter phone number" />
                } @else {
                  <p>{{ user()?.phone || 'Not provided' }}</p>
                }
              </div>

              <div class="form-group">
                <label>Member Since</label>
                <p>{{ user()?.createdAt | date: 'MMMM yyyy' }}</p>
              </div>
            </div>

            @if (isEditing()) {
              <div class="form-actions">
                <button type="button" class="btn-cancel" (click)="toggleEdit()">
                  Cancel
                </button>
                <button type="submit" class="btn-save" [disabled]="isSaving()">
                  @if (isSaving()) {
                    Saving...
                  } @else {
                    Save Changes
                  }
                </button>
              </div>
            }
          </form>
        </div>

        <!-- Preferences -->
        <div class="profile-card">
          <div class="card-header">
            <h2>Preferences</h2>
          </div>
          <div class="preferences">
            <div class="pref-item">
              <span class="material-icons">language</span>
              <div>
                <strong>Language</strong>
                <span>{{ user()?.preferences?.language || 'English' }}</span>
              </div>
            </div>
            <div class="pref-item">
              <span class="material-icons">movie</span>
              <div>
                <strong>Favorite Genres</strong>
                <span>{{ user()?.preferences?.genres?.join(', ') || 'Not set' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    }

    <!-- Bookings Tab -->
    @if (activeTab() === 'bookings') {
      <div class="tab-content">
        @if (bookings().length > 0) {
          <div class="bookings-list">
            @for (booking of bookings(); track booking.id) {
              <div class="booking-card">
                <div class="booking-header">
                  <span class="booking-id">{{ booking.bookingNumber }}</span>
                  <span class="status" [class]="getBookingStatusClass(booking.status)">
                    {{ booking.status }}
                  </span>
                </div>
                <div class="booking-details">
                  <div class="detail">
                    <span class="label">Date</span>
                    <span class="value">{{ booking.createdAt | date: 'dd MMM yyyy, hh:mm a' }}</span>
                  </div>
                  <div class="detail">
                    <span class="label">Seats</span>
                    <span class="value">{{ formatSeats(booking.seats) }}</span>
                  </div>
                  <div class="detail">
                    <span class="label">Amount</span>
                    <span class="value">₹{{ booking.totalAmount.toFixed(2) }}</span>
                  </div>
                </div>
                @if (booking.status === 'confirmed') {
                  <div class="booking-actions">
                    <a [routerLink]="['/booking', booking.id, 'confirmation']" class="btn-view">
                      View Ticket
                    </a>
                  </div>
                }
              </div>
            }
          </div>
        } @else {
          <div class="empty-state">
            <span class="material-icons">confirmation_number</span>
            <h3>No bookings yet</h3>
            <p>Your booking history will appear here</p>
            <a routerLink="/movies" class="btn-primary">Browse Movies</a>
          </div>
        }
      </div>
    }

    <!-- Payments Tab -->
    @if (activeTab() === 'payments') {
      <div class="tab-content">
        @if (payments().length > 0) {
          <div class="payments-list">
            @for (payment of payments(); track payment.id) {
              <div class="payment-card">
                <div class="payment-header">
                  <span class="transaction-id">{{ payment.transactionId }}</span>
                  <span class="status" [class]="getPaymentStatusClass(payment.status)">
                    {{ payment.status.replace('_', ' ') }}
                  </span>
                </div>
                <div class="payment-details">
                  <div class="detail">
                    <span class="label">Date</span>
                    <span class="value">{{ payment.createdAt | date: 'dd MMM yyyy' }}</span>
                  </div>
                  <div class="detail">
                    <span class="label">Method</span>
                    <span class="value">{{ formatPaymentMethod(payment.method) }}</span>
                  </div>
                  <div class="detail amount">
                    <span class="label">Amount</span>
                    <span class="value">₹{{ payment.amount.toFixed(2) }}</span>
                  </div>
                </div>
                @if (payment.refundDetails) {
                  <div class="refund-info">
                    <span class="material-icons">info</span>
                    Refund {{ payment.refundDetails.status }}
                    @if (payment.refundDetails.completedAt) {
                      on {{ payment.refundDetails.completedAt | date: 'dd MMM' }}
                    }
                  </div>
                }
              </div>
            }
          </div>
        } @else {
          <div class="empty-state">
            <span class="material-icons">payment</span>
            <h3>No payment history</h3>
            <p>Your payment transactions will appear here</p>
          </div>
        }
      </div>
    }
  </div>
</div>
